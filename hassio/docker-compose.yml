version: '3.2'

services:
  hassio:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.hassio.rule=Host(`fred-et-guillaume.cocooning.tech`)"
      - "traefik.http.routers.hassio.entrypoints=websecure"
      - "traefik.port=8123"
    image: homeassistant/raspberrypi3-homeassistant:stable
#    volumes:
#      - type: volume
#        source: cocooning-nfs
#        target: /config
#        volume:
#          nocopy: false
    volumes:
      - type: bind
        source: /apps/hassio
        target: /config
    environment:
      - TZ=Europe/Paris
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager
#    network_mode: host
    networks:
        - cocooning-network
    ports:
      - "8123"
# cr√©er le network cocooning-network avec le driver overlay (pas d'option)
networks:
  cocooning-network:
    external: true
#volumes:
#  cocooning-nfs:
#    driver: local
#    driver_opts:
#      type: "nfs4"
#      o: "nfsvers=4,addr=192.168.1.100,rw,soft,nolock"
#      device: ":/cocooning-master/hassio"